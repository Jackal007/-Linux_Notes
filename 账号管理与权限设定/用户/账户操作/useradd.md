```
useradd [-u UID] [-g 初始群组] [-G 次要群组] [-mM] [-c 说明栏] [-d 家目录绝对路径] [-s shell] 使用者账号名
选项与参数：
-u ：后面接的是 UID ，是一组数字。直接指定一个特定的 UID 给这个账号；
-g ：后面接的那个组名就是我们上面提到的 initial group 啦～
 该群组的 GID 会被放置到 /etc/passwd 的第四个字段内。
-G ：后面接的组名则是这个账号还可以加入的群组。
 这个选项与参数会修改 /etc/group 内的相关资料喔！
-M ：强制！不要建立用户家目录！(系统账号默认值)
-m ：强制！要建立用户家目录！(一般账号默认值)
-c ：这个就是 /etc/passwd 的第五栏的说明内容啦～可以随便我们设定的啦～
-d ：指定某个目录成为家目录，而不要使用默认值。务必使用绝对路径！
-r ：建立一个系统的账号，这个账号的 UID 会有限制 (参考 /etc/login.defs)
-s ：后面接一个 shell ，若没有指定则预设是 /bin/bash 的啦～
-e ：后面接一个日期，格式为『YYYY-MM-DD』此项目可写入 shadow 第八字段，
 亦即账号失效日的设定项目啰；
-f ：后面接 shadow 的第七字段项目，指定密码是否会失效。0 为立刻失
```

#### 会做的操作：

* 在 /etc/passwd 里面建立一行与账号相关的数据，包括建立 UID/GID/家目录等；
* 在 /etc/shadow 里面将此账号的密码相关参数填入，但是尚未有密码；
* 在 /etc/group 里面加入一个与账号名称一模一样的组名；
* 在 /home 底下建立一个与账号同名的目录作为用户家目录，且权限为 700

#### useradd默认值：

```
root@study ~]# useradd -D
GROUP=100 <==预设的群组
HOME=/home <==默认的家目录所在目录
INACTIVE=-1 <==密码失效日，在 shadow 内的第 7 栏
EXPIRE= <==账号失效日，在 shadow 内的第 8 栏
SHELL=/bin/bash <==预设的 shell
SKEL=/etc/skel <==用户家目录的内容数据参考目录
CREATE_MAIL_SPOOL=yes <==是否主动帮使用者建立邮件信箱(mailbox)
```

> 这个数据其实是由 /etc/default/useradd 呼叫出来的！
>
> ##### GROUP=100：新建账号的初始群组使用 GID 为 100 者
>
> 系统上面 GID 为 100 者即是 users 这个群组，此设定项目指的就是让新设使用者账号的初始群
>
> 组为 users 这一个的意思。 但是我们知道 CentOS 上面并不是这样的，在 CentOS 上面预设的
>
> 群组为与账号名相同的群组。 举例来说， vbird1 的初始群组为 vbird1 。怎么会这样啊？这是因
>
> 为针对群组的角度有两种不同的机制所致， 这两种机制分别是：
>
> ##### 私有群组机制：
>
> 系统会建立一个与账号一样的群组给使用者作为初始群组。 这种群组的设定机制会比较有保密性，
>
> 这是因为使用者都有自己的群组，而且家目录权限将会设定为 700 \(仅有自己可进入自己的家目录\)
>
> 之故。使用这种机制将不会参考 GROUP=100 这个设定值。代表性的 distributions 有 RHEL,
>
> Fedora, CentOS 等；
>
> ##### 公共群组机制：
>
> 就是以 GROUP=100 这个设定值作为新建账号的初始群组，因此每个账号都属于 users 这个群组，
>
> 且默认家目录通常的权限会是『 drwxr-xr-x ... username users ... 』，由于每个账号都属于 users 群
>
> 组，因此大家都可以互相分享家目录内的数据之故。代表 distributions 如 SuSE 等。
>
> 由于我们的 CentOS 使用私有群组机制，因此这个设定项目是不会生效的！不要太紧张啊！
>
> ##### HOME=/home：用户家目录的基准目录\(basedir\)
>
> 用户的家目录通常是与账号同名的目录，这个目录将会摆放在此设定值的目录后。所以 vbird1 的
>
> 家目录就会在 /home/vbird1/ 了！很容易理解吧！
>
> ##### INACTIVE=-1：密码过期后是否会失效的设定值
>
> 我们在 shadow 文件结构当中谈过，第七个字段的设定值将会影响到密码过期后， 在多久时间内
>
> 还可使用旧密码登入。这个项目就是在指定该日数啦！如果是 0 代表密码过期立刻失效， 如果
>
> 是 -1 则是代表密码永远不会失效，如果是数字，如 30 ，则代表过期 30 天后才失效。
>
> ##### EXPIRE=：账号失效的日期
>
> 就是 shadow 内的第八字段，你可以直接设定账号在哪个日期后就直接失效，而不理会密码的问题。
>
> 通常不会设定此项目，但如果是付费的会员制系统，或许这个字段可以设定喔！
>
> ##### SHELL=/bin/bash：默认使用的 shell 程序文件名
>
> 系统默认的 shell 就写在这里。假如你的系统为 mail server ，你希望每个账号都只能使用 email
>
> 的收发信件功能， 而不许用户登入系统取得 shell ，那么可以将这里设定为 /sbin/nologin ，如此
>
> 一来，新建的使用者预设就无法登入！ 也免去后续使用 usermod 进行修改的手续！
>
> ##### SKEL=/etc/skel：用户家目录参考基准目录
>
> 这个咚咚就是指定用户家目录的参考基准目录啰～举我们的范例一为例， vbird1 家目录
>
> /home/vbird1 内的各项数据，都是由 /etc/skel 所复制过去的～所以呢，未来如果我想要让新增使
>
> 用者时，该用户的环境变量 ~/.bashrc 就设定妥当的话，您可以到 /etc/skel/.bashrc 去编辑一下，
>
> 也可以建立 /etc/skel/www 这个目录，那么未来新增使用者后，在他的家目录下就会有 www 那
>
> 个目录了！这样瞭呼？
>
> ##### CREATE\_MAIL\_SPOOL=yes：建立使用者的 mailbox
>
> 你可以使用『 ll /var/spool/mail/vbird1 』看一下，会发现有这个文件的存在喔！这就是使用者的邮
>
> 件信箱！
>
> 除了这些基本的账号设定值之外， UID/GID 还有密码参数又是在哪里参考的呢？那就得要看一下
>
> /etc/login.defs 啦！ 这个文件的内容有点像底下这样：
>
> ```
> MAIL_DIR /var/spool/mail <==用户默认邮件信箱放置目录
> PASS_MAX_DAYS 99999 <==/etc/shadow 内的第 5 栏，多久需变更密码日数
> PASS_MIN_DAYS 0 <==/etc/shadow 内的第 4 栏，多久不可重新设定密码日数
> PASS_MIN_LEN 5 <==密码最短的字符长度，已被 pam 模块取代，失去效用！
> PASS_WARN_AGE 7 <==/etc/shadow 内的第 6 栏，过期前会警告的日数
> UID_MIN 1000 <==使用者最小的 UID，意即小于 1000 的 UID 为系统保留
> UID_MAX 60000 <==使用者能够用的最大 UID
> SYS_UID_MIN 201 <==保留给用户自行设定的系统账号最小值 UID
> SYS_UID_MAX 999 <==保留给用户自行设定的系统账号最大值 UID
> GID_MIN 1000 <==使用者自定义组的最小 GID，小于 1000 为系统保留
> GID_MAX 60000 <==使用者自定义组的最大 GID
> SYS_GID_MIN 201 <==保留给用户自行设定的系统账号最小值 GID
> SYS_GID_MAX 999 <==保留给用户自行设定的系统账号最大值 GID
> CREATE_HOME yes <==在不加 -M 及 -m 时，是否主动建立用户家目录？
> UMASK 077 <==用户家目录建立的 umask ，因此权限会是 700
> USERGROUPS_ENAB yes <==使用 userdel 删除时，是否会删除初始群组
> ENCRYPT_METHOD SHA512 <==密码加密的机制使用的是 sha512 这一个机制！
> ```
>
> 这个文件规范的数据则是如下所示：
>
>  mailbox 所在目录：
>
> 用户的默认 mailbox 文件放置的目录在 /var/spool/mail，所以 vbird1 的 mailbox 就是在
>
> /var/spool/mail/vbird1 啰！
>
>  shadow 密码第 4, 5, 6 字段内容：
>
> 透过 PASS\_MAX\_DAYS 等等设定值来指定的！所以你知道为何预设的 /etc/shadow 内每一行都会有
>
> 『 0:99999:7 』的存在了吗？^\_^！不过要注意的是，由于目前我们登入时改用 PAM 模块来进行密码检验，
>
> 所以那个 PASS\_MIN\_LEN 是失效的！
>
>  UID/GID 指定数值：
>
> 虽然 Linux 核心支持的账号可高达 2
>
> 32 这么多个，不过一部主机要作出这么多账号在管理上也是很麻烦的！
>
> 所以在这里就针对 UID/GID 的范围进行规范就是了。上表中的 UID\_MIN 指的就是可登入系统的一般账
>
> 号的最小 UID ，至于 UID\_MAX 则是最大 UID 之意。
>
> 要注意的是，系统给予一个账号 UID 时，他是 \(1\)先参考 UID\_MIN 设定值取得最小数值； \(2\)由
>
> /etc/passwd 搜寻最大的 UID 数值， 将 \(1\) 与 \(2\) 相比，找出最大的那个再加一就是新账号的 UID 了。
>
> 我们上面已经作出 UID 为 1500 的 vbird2 ， 如果再使用『 useradd vbird4 』时，你猜 vbird4 的 UID 会
>
> 是多少？答案是： 1501 。 所以中间的 1004~1499 的号码就空下来啦！
>
> 而如果我是想要建立系统用的账号，所以使用 useradd -r sysaccount 这个 -r 的选项时，就会找『比 201 大
>
> 但比 1000 小的最大的 UID 』就是了。 ^\_^
>
>  用户家目录设定值：
>
> 为何我们系统默认会帮用户建立家目录？就是这个『CREATE\_HOME = yes』的设定值啦！这个设定值会让
>
> 你在使用 useradd 时， 主动加入『 -m 』这个产生家目录的选项啊！如果不想要建立用户家目录，就只能  
> 强制加上『 -M 』的选项在 useradd 指令执行时啦！至于建立家目录的权限设定呢？就透过 umask 这个设
>
> 定值啊！因为是 077 的预设设定，因此用户家目录默认权限才会是『 drwx------ 』哩！
>
>  用户删除与密码设定值：
>
> 使用『USERGROUPS\_ENAB yes』这个设定值的功能是： 如果使用 userdel 去删除一个账号时，且该账号
>
> 所属的初始群组已经没有人隶属于该群组了， 那么就删除掉该群组，举例来说，我们刚刚有建立 vbird4 这
>
> 个账号，他会主动建立 vbird4 这个群组。 若 vbird4 这个群组并没有其他账号将他加入支持的情况下，若
>
> 使用 userdel vbird4 时，该群组也会被删除的意思。 至于『ENCRYPT\_METHOD SHA512』则表示使用
>
> SHA512 来加密密码明文，而不使用旧式的 MD5\(注 2\) 。
>
> 现在你知道啦，使用 useradd 这支程序在建立 Linux 上的账号时，至少会参考：
>
>  /etc/default/useradd
>
>  /etc/login.defs
>
>  /etc/skel/\*
>
> 这些文件，不过，最重要的其实是建立 /etc/passwd, /etc/shadow, /etc/group, /etc/gshadow 还有用户家
>
> 目录就是了～所以，如果你了解整个系统运作的状态，也是可以手动直接修改这几个文件就是了



